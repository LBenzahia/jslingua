<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Morphological test</title>
  <script type="text/javascript" src="../../jslingua.js" ></script>
  <script type="text/javascript" src="../../morpho.js" ></script>
  <!--script type="text/javascript" src="../../ara/ara.morpho.js" ></script-->
  <script type="text/javascript" src="../../eng/eng.morpho.js" ></script>

  <script type="text/javascript">

  var morpho = {};
  var $ = function(id){return document.getElementById(id)};
  var _ = function(e){return e.options[e.selectedIndex]};

  function loading(){
    var e = $("l");

    var langIDs = JsLingua.serviceLanguages("Morpho");
    var i;
    for (i = 0; i < langIDs.length; i++){
      var option = document.createElement("option");
      option.text = langIDs[i];
      e.add(option);
    }

    update();

  }

  function update(){
    var lang = _($("l")).text;
    morpho = new (JsLingua.getService("Morpho", lang))();
    $("verb").dir = JsLingua.getDir(lang);
    $("conj").dir = JsLingua.getDir(lang);
    $("stemI").dir = JsLingua.getDir(lang);
    $("stemO").dir = JsLingua.getDir(lang);

    var stemmers = morpho.availableStemmers();
    var m = $("stemM");
    var i = m.options.length;
    while (i--) m.remove(i);

    stemmers.forEach(function(element, index, array){
      var option = document.createElement("option");
      option.text = element;
      m.add(option);
    });

    setMethod();
  }

  function setMethod(){
    var sn = _($("stemM")).value;
    if (sn) morpho.setCurrentStemmer(sn);
  }

  function htmlEntities(str) {
    var result = String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;');
    result = result.replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/ /gi, "&nbsp;");
    return result;
  }

  function conjugate() {
    var verb = $("verb").value;
    var result = "<table border=\"1\">";

    //console.log(morpho.getPronounOpts());

    var tenses = morpho.getTenses();
    result += "<tr><th></th>";
    tenses.forEach(function(element, index, array){
      result += "<th>" + morpho.getTenseName(element) + "</th>";
    });
    result += "</tr>";

    morpho.getPronounOpts().forEach(function(pOpt, pIdx, pTab){
      result += "<tr>";
      result += "<th>" + morpho.getPronounName(pOpt) + "</th>";
      //create a new clone
      var allOpts = Object.assign({}, pOpt);
      tenses.forEach(function(tOpt, tIdx, tTab){
        allOpts.tense = tOpt;
        //console.log(tOpt);
        result += "<td>" + morpho.conjugate(verb, allOpts) + "</td>";
      });
      result += "</tr>";
    });

    result += "</table>"

    $("conj").innerHTML = result;
  }

  function stem(){
    $("stemO").innerHTML = morpho.stem($("stemI").value);
  }

  </script>

  <style >
  .l {
    display: inline-block;
    border: 1px solid Black;
    vertical-align: middle;
    border-radius: 2px;
    margin: 2px;
    padding: 2px;
  }
  .t {
    background-color: Violet;
  }
  .f {
    background-color: Gray;
  }
  </style>

</head>
<body>
  <div>
    <b>Language:</b>
    <select id="l" onchange="update()"></select>
  </div>
  <div>
    <b>Stemming</b>
    <select id="stemM" onchange="setMethod()">
    </select>
    <input type="text" id="stemI" />
    <button onclick="stem()">Stem</button>
    <span id="stemO"></span>
  </div>
  <div class="kfs" >
    <b>Verb Conjugation</b>
    <input type="text" id="verb" />
    <button onclick="conjugate()">Conjugate</button><br>
    <div id="conj"></div>
  </div>
  <script>
  loading();
  </script>
</body>
</html>
